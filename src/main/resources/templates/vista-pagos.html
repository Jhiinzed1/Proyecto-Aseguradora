<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Gestión de Pagos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">
    <nav class="navbar navbar-expand-lg bg-dark" data-bs-theme="dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Seguros</a>
        </div>
    </nav>

    <div class="container mt-5">
        <h1 class="mb-4">Gestión de Pagos</h1>

        <div class="card mb-5">
            <div class="card-header">Registrar Nuevo Pago</div>
            <div class="card-body">
                <form action="#" th:action="@{/pagos/registrar}" th:object="${nuevoPago}" method="post">
                    <div class="mb-3">
                        <label for="monto" class="form-label">Monto</label>
                        <input type="number" step="0.01" class="form-control" id="monto" th:field="*{monto}" required>
                    </div>
                    <div class="mb-3">
                        <label for="fecha" class="form-label">Fecha</label>
                        <input type="date" class="form-control" id="fecha" th:field="*{fecha}" required>
                    </div>
                    <div class="mb-3">
                        <label for="estado" class="form-label">Estado</label>
                        <select class="form-select" id="estado" th:field="*{estado}">
                            <option value="PENDIENTE">Pendiente</option>
                            <option value="PAGADO">Pagado</option>
                            <option value="CANCELADO">Cancelado</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="metodoPago" class="form-label">Método de Pago</label>
                        <select class="form-select" id="metodoPago" th:field="*{metodoPago}">
                            <option value="EFECTIVO">Efectivo</option>
                            <option value="TARJETA_CREDITO">Tarjeta de Crédito</option>
                            <option value="TARJETA_DEBITO">Tarjeta de Débito</option>
                            <option value="TRANSFERENCIA">Transferencia</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="idPoliza" class="form-label">Póliza</label>
                        <select class="form-select" id="idPoliza" th:field="*{idPoliza}" required>
                            <option value="" disabled selected>Seleccione una Póliza</option>
                            <option th:each="poliza : ${polizas}" th:value="${poliza.id}"
                                th:data-precio="${poliza.tipoPoliza.preciobase}"
                                th:text="${poliza.numeroPoliza} + ' - ' + ${poliza.cliente.nombre}"></option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">Guardar Pago</button>
                    <a href="/" class="btn btn-secondary ms-2">Volver al Inicio</a>
                </form>
            </div>
        </div>

        <h2 class="mb-3">Listado de Pagos</h2>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Monto</th>
                    <th>Fecha</th>
                    <th>Estado</th>
                    <th>Método</th>
                    <th>Póliza</th>
                    <th>Cliente</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="pago : ${pagos}">
                    <td th:text="${pago.id}">1</td>
                    <td th:text="${pago.monto}">1000.00</td>
                    <td th:text="${pago.fecha}">2023-01-01</td>
                    <td th:text="${pago.estado}">PAGADO</td>
                    <td th:text="${pago.metodoPago}">EFECTIVO</td>
                    <td th:text="${pago.poliza.numeroPoliza}">POL-123</td>
                    <td th:text="${pago.poliza.cliente.nombre}">Juan Perez</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        document.getElementById('idPoliza').addEventListener('change', function () {
            var selectedOption = this.options[this.selectedIndex];
            var precio = selectedOption.getAttribute('data-precio');
            if (precio) {
                document.getElementById('monto').value = precio;
            }
        });
    </script>
</body>

</html>